events {}

http {
  # Global settings
  client_max_body_size 100M;
  send_timeout 120s;
  proxy_read_timeout 120s;
  proxy_connect_timeout 120s;
  proxy_send_timeout 120s;

  server {
    listen 80;

    # Reverse proxy rules under /api
    location /api/scrape {
      proxy_pass http://trendscraper:3000/scrape;
    }

    location /api/generate {
      proxy_pass http://trendscraper:3000/generate;
    }

    location /api/burn {
      proxy_pass http://trendscraper:3000/burn;
    }

    location /api/coquiSpeakerId {
      proxy_pass http://trendscraper:3000/coquiSpeakerId;
    }
    
    location /api/align {
      proxy_pass http://speechalign:5000/align;
    }

    location /api/tts {
      proxy_pass http://coqui:5002/api/tts;
    }

    # Allow CORS for /api if needed
    location /api/ {
      add_header 'Access-Control-Allow-Origin' '*' always;
      add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
      add_header 'Access-Control-Allow-Headers' '*';
      if ($request_method = OPTIONS) {
        return 204;
      }
    }

    # Serve static files from nginx/html/
    location / {
      root /usr/share/nginx/html;
      try_files $uri $uri/ =404;
    }
  }
}
